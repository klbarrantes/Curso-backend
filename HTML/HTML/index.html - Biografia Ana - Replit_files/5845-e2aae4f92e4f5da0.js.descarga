"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5845],{3116:function(e,t,r){r.d(t,{Z:function(){return le}});var n=r(57135),a=r(57389),o=r(9970),l=r(96583),i=r(94660),c=r(79960),s=r(12922),u=r(58530),d=r(99340),g=r(18873),h=r(72006),f=r(43119),p=r(71440),m=r(53486);function v(){var e=(0,f.Z)(["\n  fragment AccountStorageUtilization on AccountStorageUtilization {\n    __typename\n    total\n    perRepl {\n      __typename\n      usage\n      percentage\n      repl {\n        __typename\n        id\n        slug\n        url\n        title\n        nextPagePathname\n      }\n    }\n  }\n"]);return v=function(){return e},e}function y(){var e=(0,f.Z)(["\n  query ManageAccountStorageUtilizationCurrentUser {\n    currentUser {\n      __typename\n      id\n      storageInfo {\n        accountStorageUtilization {\n          ...AccountStorageUtilization\n          ... on UnauthorizedError {\n            __typename\n            message\n          }\n        }\n      }\n    }\n  }\n  ","\n"]);return y=function(){return e},e}var Z={},b=(0,p.Ps)(v()),x=(0,p.Ps)(y(),b);var w=1048576,G=1024*w,S=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e>w||t?"".concat((e/G).toFixed(4)," GiB"):"".concat((e/w).toFixed(4)," MiB")},U=r(59496),_=u.tX.categorical,B=.0075,X=(0,u.Xb)({self:[u.l0.height("100%")]}),R=function(e){var t=e.percentage,r=e.color;return(0,i.tZ)(u.G7,{css:X.self,style:(0,a.Z)({minWidth:"calc(".concat(.75,"%)"),width:"calc(".concat(t,"% - 1px)"),backgroundColor:r},"&:last-of-type",{width:"".concat(t,"%")})})},W=(0,u.Xb)({self:[u.l0.rowWithGap(8),u.l0.align.center],dot:[u.l0.width(8),u.l0.height(8),{borderRadius:"50%"}],title:[u.l0.flex.grow(1)]}),N=function(e){var t=e.color,r=e.title,n=e.usage;return(0,i.BX)(u.G7,{css:W.self,children:[(0,i.tZ)("div",{css:W.dot,style:{backgroundColor:t}}),(0,i.tZ)(u.xv,{css:W.title,children:r}),(0,i.tZ)(u.xv,{color:"dimmer",children:S(n)})]})},k=(0,u.Xb)({self:[u.l0.colWithGap(4)]}),C=function(e){var t=e.topRepls,r=e.groupedRepls,n=e.groupedTotal;return(0,i.BX)(u.G7,{css:k.self,children:[0===t.length?(0,i.tZ)(u.xv,{children:"No storage usage"}):null,t.map((function(e,t){return(0,i.tZ)(N,{color:_[t%_.length],title:e.repl.title,usage:e.usage},t)})),0!==r.length?(0,i.tZ)(N,{color:u.TV.backgroundHighest,title:"+".concat(r.length+1," more"),usage:n}):null]})},E=(0,u.Xb)({self:[u.l0.width("100%"),u.l0.rowWithGap(1),u.l0.height(16),u.l0.borderRadius(4),u.l0.overflow("hidden"),u.l0.backgroundColor.backgroundHigher]}),M=function(e){var t=e.summary,r=t.perRepl,n=t.total,a=(0,o.Z)(r).filter((function(e){return e.percentage>0})).sort((function(e,t){return t.usage-e.usage})),l=a.slice(0,8),c=a.slice(8),s=c.reduce((function(e,t){return e+t.usage}),0),d=function(e,t){var r=new Array,n=0,a=!0,o=!1,l=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var s=i.value,u=Math.max(s.percentage,B),d=u-s.percentage;0!==d&&(n+=d),r.push({percentage:u,adjusted:0!==d,grouped:!1})}}catch(w){o=!0,l=w}finally{try{a||null==c.return||c.return()}finally{if(o)throw l}}var g=0===t?0:Math.max(t,B);if(g>0){var h=g-t;h>0&&(n+=h),r.push({percentage:g,adjusted:h>0,grouped:!0})}if(n>0){var f=r.filter((function(e){return!e.adjusted})),p=f.length;if(p>0){var m=n/p,v=!0,y=!1,Z=void 0;try{for(var b,x=f[Symbol.iterator]();!(v=(b=x.next()).done);v=!0)b.value.percentage-=m}catch(w){y=!0,Z=w}finally{try{v||null==x.return||x.return()}finally{if(y)throw Z}}}}return r}(l,0===n?0:s/n);return(0,i.tZ)(u.G7,{children:(0,i.tZ)(u.u,{maxWidth:400,delay:"none",tooltip:(0,i.tZ)(C,{topRepls:l,groupedRepls:c,groupedTotal:s}),children:(0,i.tZ)(u.G7,{css:E.self,children:d.map((function(e,t){return(0,i.tZ)(R,{percentage:100*e.percentage,color:e.grouped?u.TV.backgroundHighest:_[t%_.length]},t)}))})})})},z=r(24880),T=r(96785),I=r(4405),j=r(61262),P=function(e){switch(e.__typename){case"AccountStorageUtilization":return A(e);case"MonthlyEgressSummary":return D(e);default:(0,j.Z)(e)}},A=function(e){var t=e.total,r=e.perRepl;return{total:Number(t),perRepl:r.map(F)}},D=function(e){var t=e.usage,r=e.limit,n=e.perRepl;return{total:Number(t),limit:Number(r),perRepl:n.map(F)}},F=function(e){return(0,I.Z)((0,h.Z)({},e),{usage:Number(e.usage)})},H=(0,u.Xb)({self:[u.l0.p(16),u.l0.colWithGap(12),u.l0.flex.growAndShrink(1),u.l0.borderRadius(8),u.l0.border({color:u.TV.outlineDimmest,width:1,style:"solid"})],loadingWrapper:[u.l0.center],errorMessage:[u.l0.width("100%"),u.l0.center,{alignSelf:"center",justifySelf:"center"}],header:[u.l0.rowWithGap(16),u.l0.align.center,u.l0.justify.spaceBetween],footer:[u.l0.rowWithGap(16),u.l0.justify.spaceBetween,u.l0.align.center],footerActions:[u.l0.rowWithGap(8),u.l0.justify.spaceBetween,u.l0.align.center]}),O=function(){var e,t=(0,d.Z)().showError,r=function(e){var t=(0,h.Z)({},Z,e);return m.a(x,t)}({onError:function(e){return t((0,g.Z)(e.message))},onCompleted:function(e){var r;"CurrentUser"===(null===(r=e.currentUser)||void 0===r?void 0:r.__typename)&&"UnauthorizedError"===e.currentUser.storageInfo.accountStorageUtilization.__typename&&t(e.currentUser.storageInfo.accountStorageUtilization.message)}}),n=r.data;if(r.loading)return(0,i.tZ)(u.Tg,{elevated:!0,css:H.self,children:(0,i.tZ)(u.G7,{css:H.loadingWrapper,children:(0,i.tZ)(z.Z,{})})});if(n&&"CurrentUser"===(null===(e=n.currentUser)||void 0===e?void 0:e.__typename)&&"AccountStorageUtilization"===n.currentUser.storageInfo.accountStorageUtilization.__typename){var a=n.currentUser.storageInfo.accountStorageUtilization,o=a.total;return(0,i.BX)(u.Tg,{elevated:!0,css:H.self,children:[(0,i.BX)(u.G7,{css:H.header,children:[(0,i.tZ)(u.xv,{variant:"subheadDefault",children:"Storage"}),(0,i.tZ)(u.xv,{color:"dimmer",children:S(Number(o),!0)})]}),(0,i.tZ)(M,{summary:P(a)}),(0,i.tZ)(L,{})]})}return(0,i.BX)(u.G7,{css:H.self,children:[(0,i.tZ)(V,{total:"0"}),(0,i.tZ)(u.G7,{css:H.errorMessage,children:(0,i.tZ)(u.xv,{color:"dimmest",children:"We had trouble loading your storage information. Please try again later."})}),(0,i.tZ)(L,{})]})},V=function(e){var t=e.total;return(0,i.BX)(u.G7,{css:H.header,children:[(0,i.tZ)(u.xv,{variant:"subheadDefault",children:"Storage"}),(0,i.tZ)(u.xv,{color:"dimmer",children:S(Number(t),!0)})]})},L=function(){return(0,i.BX)(u.G7,{css:H.footer,children:[(0,i.tZ)(u.ZP,{href:T.$I.href,as:T.$I.as,text:"Manage Repls"}),(0,i.tZ)(u.zx,{disabled:!0,colorway:"primary",text:"Upgrade Storage"})]})},q=r(9362),J=r(69735),$=r(10430),K=r(13168),Q=r(92112),Y=(0,u.Xb)({self:[u.l0.colWithGap(12),u.l0.justify.center]}),ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e>1e6||t){var r=(e/1073741824).toFixed(1);return"".concat(parseFloat(r)," GiB")}var n=(e/1048576).toFixed(1);return"".concat(parseFloat(n)," MiB")},te=function(e){var t=e.color,r=e.title,n=e.usage;return(0,i.BX)(u.G7,{css:[u.l0.rowWithGap(8),u.l0.align.center],children:[(0,i.tZ)("div",{css:[u.l0.width(8),u.l0.height(8),{backgroundColor:t,borderRadius:"50%"}]}),(0,i.tZ)(u.xv,{css:[u.l0.flex.grow(1)],children:r}),(0,i.tZ)(u.xv,{color:"dimmer",children:ee(n)})]})},re=.0075,ne=function(e){var t=e.percentage,r=e.color;return(0,i.tZ)(u.G7,{css:[u.l0.width("calc(".concat(t,"% - 1px)")),u.l0.minWidth("".concat(.75,"%")),u.l0.height("100%"),{backgroundColor:r,":last-of-type":{width:"".concat(t,"%")}}]})},ae=(0,u.Xb)({self:[u.l0.p(16),u.l0.colWithGap(12),u.l0.flex.growAndShrink(1),u.l0.borderRadius(8),u.l0.border({color:u.TV.outlineDimmest,width:1,style:"solid"})]}),oe=function(e){var t=e.context,r=e.summary,n=e.onPotentialLimitChange,l=e.title,d=e.titleShort,g=(0,U.useState)(!1),h=g[0],f=g[1],p=(0,s.P)({controlName:"flag-egress-snafu"}),m=(0,s.P)({controlName:"flag-egress-add-on"}),v=u.tX.categorical,y=Number(r.monthly.usage),Z=Number(r.monthly.limit),b=Math.max(y,Z),x=(0,o.Z)(r.monthly.perRepl).filter((function(e){return e.percentage>0})).sort((function(e,t){return Number(t.usage)-Number(e.usage)})),w=x.slice(0,8),G=x.slice(8),S=G.reduce((function(e,t){return e+Number(t.usage)}),0),_=function(e,t){var r=new Array,n=0,a=!0,o=!1,l=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var s=i.value,u=Math.max(s.percentage,re),d=u-s.percentage;0!==d&&(n+=d),r.push({percentage:u,adjusted:0!==d,grouped:!1})}}catch(w){o=!0,l=w}finally{try{a||null==c.return||c.return()}finally{if(o)throw l}}var g=0===t?0:Math.max(t,re);if(g>0){var h=g-t;h>0&&(n+=h),r.push({percentage:g,adjusted:h>0,grouped:!0})}if(n>0){var f=r.filter((function(e){return!e.adjusted})),p=f.length;if(p>0){var m=n/p,v=!0,y=!1,Z=void 0;try{for(var b,x=f[Symbol.iterator]();!(v=(b=x.next()).done);v=!0)b.value.percentage-=m}catch(w){y=!0,Z=w}finally{try{v||null==x.return||x.return()}finally{if(y)throw Z}}}}return r}(w,0===b?0:S/b);return(0,i.BX)(u.Tg,{elevated:!0,css:ae.self,children:[(0,i.BX)(u.G7,{tag:"header",css:[u.l0.rowWithGap(16),u.l0.align.center,u.l0.justify.spaceBetween,(0,a.Z)({},(0,$.EM)("mobileMax"),[u.l0.flex.wrap])],children:[(0,i.BX)(u.G7,{css:[u.l0.rowWithGap(4),u.l0.align.center],children:[(0,i.tZ)(u.xv,{variant:"subheadDefault",css:[u.l0.display.flex,(0,a.Z)({},(0,$.EM)("mobileMax"),[u.l0.display.none])],children:l}),(0,i.tZ)(u.xv,{variant:"subheadDefault",css:[u.l0.display.none,(0,a.Z)({},(0,$.EM)("mobileMax"),{display:"unset"})],children:d}),(0,i.tZ)(u.u,{tooltip:(0,i.tZ)(u.xv,{multiline:!0,children:"Similar to bandwidth, outbound data transfer is the amount of data that our servers send to your Repls' users and external services."}),children:(0,i.tZ)(q.Z,{css:[(0,a.Z)({},(0,$.EM)("mobileMax"),[u.l0.display.none])]})})]}),(0,i.BX)(u.G7,{css:[u.l0.rowWithGap(4),u.l0.align.center],children:[r.monthly.isThrottled?(0,i.tZ)(u.u,{tooltip:(0,i.tZ)(u.xv,{multiline:!0,children:"Bandwidth for your Repls is being throttled. Increase your limit to resume normal speeds."}),children:(0,i.tZ)(J.Z,{color:"red"})}):null,(0,i.tZ)(u.xv,{color:"dimmer",css:[u.l0.py(1)],children:0!==Z?"".concat(ee(y,!0)," / ").concat(ee(Z,!0)):"".concat(ee(y))})]})]}),(0,i.tZ)(u.G7,{children:(0,i.tZ)(u.u,{maxWidth:400,delay:"none",tooltip:(0,i.BX)(u.G7,{css:u.l0.colWithGap(4),children:[0===w.length?(0,i.tZ)(u.xv,{children:"No egress usage"}):null,w.map((function(e,t){return(0,i.tZ)(te,{color:v[t%v.length],title:e.repl.title,usage:Number(e.usage)},t)})),0!==G.length?(0,i.tZ)(te,{color:u.TV.backgroundHighest,title:"+".concat(G.length+1," more"),usage:S}):null]}),children:(0,i.tZ)(u.G7,{css:[u.l0.rowWithGap(1),u.l0.height(16),u.l0.borderRadius(4),u.l0.backgroundColor.backgroundHigher,{overflow:"hidden"}],children:_.map((function(e,t){return(0,i.tZ)(ne,{percentage:100*e.percentage,color:e.grouped?u.TV.backgroundHighest:v[t%v.length]},t)}))})})}),(0,i.BX)(u.G7,{tag:"footer",css:[u.l0.rowWithGap(16),u.l0.justify.spaceBetween,u.l0.align.center],children:[(0,i.BX)(u.xv,{color:"dimmest",children:["Resets on ",r.monthly.resets]}),m||r.monthly.showUpgrade?(0,i.tZ)(u.zx,{colorway:"primary",text:"Increase limit",onClick:function(){return f(!h)}}):null,m||r.monthly.showUpgrade||r.monthly.isEnforced?null:(0,i.tZ)(u.xv,{color:"dimmest",children:"Limit not yet enforced"})]}),p?(0,i.tZ)(u.G7,{children:(0,i.tZ)(u.xv,{color:"dimmest",multiline:!0,css:[u.l0.textAlign.center],children:"Numbers look off? We're recovering from an external service issue and resetting usage."})}):null,(0,i.tZ)(K.Z,{isOpen:!m&&h,initialTab:"plans",context:t,onRequestClose:function(){f(!1),n()}}),(0,i.tZ)(c.Z,{isOpen:m&&h,context:t,powerUp:"egress",uponPurchaseGoTo:"account_resource_usage"===t?"account":"cyclesPage",onRequestClose:function(){f(!1),n()}})]})},le=function(e){var t=e.context,r=e.title,a=void 0===r?"Outbound Data Transfer":r,o=e.titleShort,c=void 0===o?"Data Transfer":o,d=(0,U.useState)(),g=d[0],h=d[1],f=(0,U.useState)(),p=f[0],m=f[1],v=(0,s.P)({controlName:"flag-storage-utilization"}),y=function(e){var t;if("CurrentUser"===(null===(t=e.currentUser)||void 0===t?void 0:t.__typename))switch(e.currentUser.egress.__typename){case"UserEgressSummary":m(e.currentUser.egress);break;case"UnauthorizedError":case"UserError":h(e.currentUser.egress.message);break;default:h("Unexpected response")}else h("Unexpected response")},Z=(0,Q.Ez)({onCompleted:y,onError:function(e){h(e.message)}}),b=Z.loading,x=Z.refetch;return(0,i.BX)(u.G7,{css:Y.self,children:[b?(0,i.tZ)(z.Z,{}):null,g?(0,i.tZ)(u.E_,{colorway:"negative",text:g}):null,p?(0,i.tZ)(oe,{context:t,onPotentialLimitChange:(0,n.Z)((function(){var e,t;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,x()];case 1:return(e=r.sent()).error?h(e.error.message):e.errors?h("Something unexpected happened, please try again"):y(e.data),[3,3];case 2:return t=r.sent(),h(t.message),[3,3];case 3:return[2]}}))})),summary:p,title:a,titleShort:c}):null,v?(0,i.tZ)(O,{}):null]})}},33756:function(e,t,r){var n=r(57135),a=r(96583),o=r(70474);t.Z=function(){var e=(0,n.Z)((function(e,t){var r,n,l;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return e?(r=e.user,[3,4]):[3,1];case 1:return(n=t.getState().user)&&n.userInfo.isLoggedIn&&n.userInfo?(r=n.userInfo,[3,4]):[3,2];case 2:return[4,(0,o.LK)("/is_authenticated")];case 3:(l=a.sent()).success&&(r=l.user),a.label=4;case 4:return r&&(e&&(r=JSON.parse(JSON.stringify(r))),t.dispatch({type:"FETCH_USER_INFO_SUCCESS",user:r})),[2,{user:r}]}}))}));return function(t,r){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=5845-e2aae4f92e4f5da0.js.map